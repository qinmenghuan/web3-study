# 更新池子状态工具

这个工具用于手动更新所有池子的完整状态，包括：
- `sqrt_price_x96`: 当前价格的平方根（Q96格式）
- `tick`: 当前价格对应的tick值
- `liquidity`: 池子的总流动性
- `reserve0`: token0的余额
- `reserve1`: token1的余额

## 使用方法

```bash
cd sync
go run cmd/update_reserves/main.go -config config.yaml
```

## 功能说明

1. 连接到 PostgreSQL 数据库
2. 查询所有池子
3. 对每个池子：
   - 调用 `pool.slot0()` 获取 `sqrtPriceX96` 和 `tick`
   - 调用 `pool.liquidity()` 获取流动性
   - 调用 `token0.balanceOf(pool)` 和 `token1.balanceOf(pool)` 获取余额
4. 更新数据库中的所有相关字段

## 使用场景

- **初始化数据**：当池子创建后，确保所有字段都有正确的初始值
- **修复数据**：如果发现某些池子的状态数据不完整或过时，可以使用此工具修复
- **定期同步**：可以定期运行此工具，确保数据库中的状态与链上一致

## 注意事项

- 工具会在每个池子更新之间添加 200ms 延迟，避免 RPC 限流
- 如果某个池子更新失败，会记录错误日志但继续处理其他池子
- 建议在网络稳定时运行，确保 RPC 调用成功
- 对于大量池子，可能需要较长时间完成

## 故障排查

如果看到大量错误日志：
1. 检查 RPC 连接是否正常
2. 检查代币合约地址是否正确
3. 检查池子地址是否有效
4. 检查池子合约是否实现了 `slot0()` 和 `liquidity()` 方法

