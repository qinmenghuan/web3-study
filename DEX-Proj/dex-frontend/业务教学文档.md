# MetaNodeSwap DEX å‰ç«¯ä¸šåŠ¡æ•™å­¦æ–‡æ¡£

## ğŸ“š ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
3. [ä¸šåŠ¡æµç¨‹è¯¦è§£](#ä¸šåŠ¡æµç¨‹è¯¦è§£)
4. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
5. [API æ¥å£è¯´æ˜](#api-æ¥å£è¯´æ˜)
6. [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)

---

## é¡¹ç›®æ¦‚è¿°

MetaNodeSwap æ˜¯ä¸€ä¸ªåŸºäº Uniswap V3 è®¾è®¡çš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆDEXï¼‰å‰ç«¯åº”ç”¨ï¼Œè¿è¡Œåœ¨ Sepolia æµ‹è¯•ç½‘ç»œä¸Šã€‚è¯¥å¹³å°æä¾›äº†å®Œæ•´çš„ä»£å¸äº¤æ¢ã€æµåŠ¨æ€§ç®¡ç†å’Œå¤´å¯¸ç®¡ç†åŠŸèƒ½ã€‚

### ä¸»è¦ç‰¹æ€§

- ğŸ”„ **ä»£å¸äº¤æ¢**: æ”¯æŒä»»æ„ ERC20 ä»£å¸ä¹‹é—´çš„äº¤æ¢
- ğŸ’§ **æµåŠ¨æ€§æ± ç®¡ç†**: åˆ›å»ºæ± å­ã€æ·»åŠ /ç§»é™¤æµåŠ¨æ€§
- ğŸ“Š **å¤´å¯¸ç®¡ç†**: æŸ¥çœ‹å’Œç®¡ç†ç”¨æˆ·çš„æµåŠ¨æ€§å¤´å¯¸
- ğŸ¨ **ç°ä»£åŒ– UI**: åŸºäº Tailwind CSS çš„å“åº”å¼è®¾è®¡
- ğŸ”— **Web3 é›†æˆ**: æ”¯æŒ MetaMask ç­‰é’±åŒ…è¿æ¥
- ğŸ“ˆ **æ•°æ®å¯è§†åŒ–**: å®æ—¶æ˜¾ç¤ºæ± å­ç»Ÿè®¡å’Œäº¤æ˜“è®°å½•
- ğŸ¯ **NFT åŠŸèƒ½**: NFT æ”¶è—å±•ç¤ºå’Œ API æµ‹è¯•
- ğŸ” **åŒºå—é“¾æ‰«æå™¨**: æŸ¥çœ‹é“¾ä¸Šäº¤æ˜“å’Œæ± å­æ•°æ®

### æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 15 (App Router)
- **æ ·å¼**: Tailwind CSS 4
- **Web3**: Wagmi + Viem + RainbowKit
- **çŠ¶æ€ç®¡ç†**: React Query (TanStack Query)
- **è¯­è¨€**: TypeScript
- **åŒ…ç®¡ç†å™¨**: Bun

---

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ä»£å¸äº¤æ¢ (Swap)

**è·¯å¾„**: `/` (ä¸»é¡µ)

**åŠŸèƒ½æè¿°**:
- ç”¨æˆ·å¯ä»¥åœ¨ä¸¤ä¸ªä»£å¸ä¹‹é—´è¿›è¡Œäº¤æ¢
- å®æ—¶è·å–ä»·æ ¼æŠ¥ä»·
- æ”¯æŒæ»‘ç‚¹è®¾ç½®
- è‡ªåŠ¨æ£€æŸ¥ä»£å¸æˆæƒçŠ¶æ€

**æ ¸å¿ƒç»„ä»¶**: `SwapInterface`

**ä¸»è¦åŠŸèƒ½ç‚¹**:

1. **ä»£å¸é€‰æ‹©**
   - ä»é¢„å®šä¹‰ä»£å¸åˆ—è¡¨ä¸­é€‰æ‹©
   - æ”¯æŒå¿«é€Ÿåˆ‡æ¢è¾“å…¥/è¾“å‡ºä»£å¸

2. **ä»·æ ¼æŠ¥ä»·**
   - å®æ—¶è°ƒç”¨åç«¯ API è·å–æœ€ä¼˜ä»·æ ¼
   - æ˜¾ç¤ºä»·æ ¼å½±å“å’Œé¢„ä¼°è¾“å‡ºæ•°é‡
   - æ”¯æŒæ¨¡æ‹ŸæŠ¥ä»·ï¼ˆå½“æ± å­ä¸å­˜åœ¨æ—¶ï¼‰

3. **ä»£å¸æˆæƒ**
   - è‡ªåŠ¨æ£€æµ‹æ˜¯å¦éœ€è¦æˆæƒ
   - ä¸€é”®æˆæƒåŠŸèƒ½
   - æˆæƒåè‡ªåŠ¨åˆ·æ–°çŠ¶æ€

4. **äº¤æ˜“æ‰§è¡Œ**
   - è°ƒç”¨ SwapRouter åˆçº¦æ‰§è¡Œäº¤æ¢
   - å®æ—¶æ˜¾ç¤ºäº¤æ˜“çŠ¶æ€ï¼ˆç­‰å¾…ç¡®è®¤ã€ç¡®è®¤ä¸­ã€æˆåŠŸï¼‰
   - æ˜¾ç¤ºäº¤æ˜“å“ˆå¸Œ

**ä¸šåŠ¡æµç¨‹**:

```
1. ç”¨æˆ·é€‰æ‹©è¾“å…¥ä»£å¸å’Œè¾“å‡ºä»£å¸
2. è¾“å…¥äº¤æ¢æ•°é‡
3. ç³»ç»Ÿè‡ªåŠ¨è·å–ä»·æ ¼æŠ¥ä»·ï¼ˆé˜²æŠ– 500msï¼‰
4. æ£€æŸ¥ä»£å¸æˆæƒçŠ¶æ€
5. å¦‚éœ€æˆæƒï¼Œå…ˆæ‰§è¡Œæˆæƒäº¤æ˜“
6. ç”¨æˆ·ç¡®è®¤äº¤æ¢
7. æ‰§è¡Œäº¤æ¢äº¤æ˜“
8. ç­‰å¾…äº¤æ˜“ç¡®è®¤
9. æ˜¾ç¤ºäº¤æ˜“ç»“æœ
```

**å…³é”®ä»£ç ä½ç½®**:
- ç»„ä»¶: `src/components/swap/SwapInterface.tsx`
- Hook: `src/hooks/useSwap.ts`
- API: `src/app/api/quote/route.ts`

---

### 2. æµåŠ¨æ€§æ±  (Pools)

**è·¯å¾„**: `/pools`

**åŠŸèƒ½æè¿°**:
- æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æµåŠ¨æ€§æ± 
- æ˜¾ç¤ºæ± å­çš„å…³é”®æŒ‡æ ‡ï¼ˆTVLã€24h äº¤æ˜“é‡ã€è´¹ç‡ç­‰ï¼‰
- ç‚¹å‡»æ± å­æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯

**æ ¸å¿ƒç»„ä»¶**: `PoolsPage`

**æ˜¾ç¤ºä¿¡æ¯**:

1. **æ± å­åŸºæœ¬ä¿¡æ¯**
   - äº¤æ˜“å¯¹ï¼ˆToken0/Token1ï¼‰
   - è´¹ç‡ç­‰çº§ï¼ˆ0.05%, 0.3%, 1%ï¼‰
   - æ± å­åœ°å€

2. **æ± å­ç»Ÿè®¡æ•°æ®**
   - TVL (æ€»é”å®šä»·å€¼)
   - 24h äº¤æ˜“é‡
   - APR (å¹´åŒ–æ”¶ç›Šç‡)
   - æµåŠ¨æ€§æ•°é‡

3. **æ“ä½œæŒ‰é’®**
   - "Add Pool" - è·³è½¬åˆ°æ·»åŠ æµåŠ¨æ€§é¡µé¢

**æ•°æ®æ¥æº**:
- åç«¯ API: `/api/pools`
- ä»æ•°æ®åº“è·å–æ± å­åˆ—è¡¨å’Œç»Ÿè®¡æ•°æ®

**å…³é”®ä»£ç ä½ç½®**:
- é¡µé¢: `src/app/pools/page.tsx`
- API: `src/app/api/pools/route.ts`

---

### 3. æ± å­è¯¦æƒ… (Pool Detail)

**è·¯å¾„**: `/pools/[address]`

**åŠŸèƒ½æè¿°**:
- æŸ¥çœ‹ç‰¹å®šæ± å­çš„è¯¦ç»†ä¿¡æ¯
- æ˜¾ç¤ºæ± å­çš„å†å²äº¤æ˜“è®°å½•
- æ˜¾ç¤ºä»·æ ¼å›¾è¡¨å’ŒæµåŠ¨æ€§åˆ†å¸ƒ

**æ ¸å¿ƒç»„ä»¶**: `PoolDetailClient`

**æ˜¾ç¤ºå†…å®¹**:

1. **æ± å­æ¦‚è§ˆ**
   - äº¤æ˜“å¯¹ä¿¡æ¯
   - å½“å‰ä»·æ ¼
   - TVL å’Œäº¤æ˜“é‡
   - è´¹ç‡ä¿¡æ¯

2. **äº¤æ˜“å†å²**
   - æœ€è¿‘çš„äº¤æ¢è®°å½•
   - äº¤æ˜“å“ˆå¸Œã€æ—¶é—´ã€æ•°é‡ç­‰

3. **æ“ä½œé€‰é¡¹**
   - æ·»åŠ æµåŠ¨æ€§
   - ç§»é™¤æµåŠ¨æ€§
   - æŸ¥çœ‹å¤´å¯¸

**å…³é”®ä»£ç ä½ç½®**:
- é¡µé¢: `src/app/pools/[address]/page.tsx`
- å®¢æˆ·ç«¯ç»„ä»¶: `src/app/pools/[address]/PoolDetailClient.tsx`
- API: `src/app/api/pools/[address]/route.ts`

---

### 4. æµåŠ¨æ€§ç®¡ç† (Liquidity)

**è·¯å¾„**: `/liquidity`

**åŠŸèƒ½æè¿°**:
- åˆ›å»ºæ–°çš„æµåŠ¨æ€§æ± 
- å‘ç°æœ‰æ± å­æ·»åŠ æµåŠ¨æ€§
- ç®¡ç†æµåŠ¨æ€§å¤´å¯¸

**æ ¸å¿ƒç»„ä»¶**: `LiquidityManager`

**ä¸šåŠ¡æµç¨‹**:

#### æ­¥éª¤ 1: é€‰æ‹©æ± å­å‚æ•°

ç”¨æˆ·éœ€è¦é€‰æ‹©:
- Token0 åœ°å€
- Token1 åœ°å€
- è´¹ç‡ç­‰çº§ (500, 3000, 10000)
- é“¾ ID (å½“å‰ä¸º Sepolia: 11155111)

#### æ­¥éª¤ 2: æœç´¢æ± å­

ç³»ç»Ÿä¼šè°ƒç”¨ `/api/pools/check` æ£€æŸ¥æ± å­æ˜¯å¦å­˜åœ¨:

- **å¦‚æœæ± å­å­˜åœ¨**:
  - æ˜¾ç¤ºæ± å­åœ°å€å’Œç´¢å¼•
  - æä¾›ä¸¤ä¸ªé€‰é¡¹:
    1. ä½¿ç”¨ç°æœ‰æ± å­
    2. åˆ›å»ºæ–°æ± å­

- **å¦‚æœæ± å­ä¸å­˜åœ¨**:
  - æç¤ºå°†åˆ›å»ºæ–°æ± å­
  - è¿›å…¥æ·»åŠ æµåŠ¨æ€§ç•Œé¢

#### æ­¥éª¤ 3: æ·»åŠ æµåŠ¨æ€§

**å¯¹äºæ–°æ± å­**:
1. è®¾ç½®åˆå§‹ä»·æ ¼æ¯”ç‡ (Token0:Token1)
2. è¾“å…¥ä¸¤ä¸ªä»£å¸çš„æ•°é‡
3. ç³»ç»Ÿæ ¹æ®ä»·æ ¼æ¯”ç‡è‡ªåŠ¨è®¡ç®—å¯¹åº”æ•°é‡
4. æ£€æŸ¥ä»£å¸æˆæƒ
5. æ‰§è¡Œåˆ›å»ºæ± å­å¹¶æ·»åŠ æµåŠ¨æ€§çš„äº¤æ˜“

**å¯¹äºå·²å­˜åœ¨æ± å­**:
1. è¾“å…¥ä»£å¸æ•°é‡
2. ç³»ç»Ÿæ ¹æ®æ± å­å½“å‰ä»·æ ¼è®¡ç®—å¯¹åº”æ•°é‡
3. æ£€æŸ¥ä»£å¸æˆæƒ
4. æ‰§è¡Œæ·»åŠ æµåŠ¨æ€§äº¤æ˜“

**å…³é”®åŠŸèƒ½**:

1. **ä»·æ ¼è®¡ç®—**
   - æ–°æ± å­: ä½¿ç”¨ç”¨æˆ·è®¾ç½®çš„åˆå§‹ä»·æ ¼æ¯”ç‡
   - å·²å­˜åœ¨æ± å­: è°ƒç”¨ `/api/pools/price` è·å–å½“å‰ä»·æ ¼

2. **ä»£å¸æˆæƒ**
   - è‡ªåŠ¨æ£€æŸ¥ä¸¤ä¸ªä»£å¸çš„æˆæƒçŠ¶æ€
   - åˆ†åˆ«æˆæƒï¼ˆå¦‚æœéœ€è¦ï¼‰

3. **äº¤æ˜“æ‰§è¡Œ**
   - æ–°æ± å­: è°ƒç”¨ `PoolManager.createAndInitializePoolIfNecessary`
   - å·²å­˜åœ¨æ± å­: è°ƒç”¨ `PositionManager.mint`

**å…³é”®ä»£ç ä½ç½®**:
- ç»„ä»¶: `src/components/pools/LiquidityManager.tsx`
- Hook: `src/hooks/useCreatePool.ts`
- API: 
  - `src/app/api/pools/check/route.ts`
  - `src/app/api/pools/price/route.ts`

---

### 5. å¤´å¯¸ç®¡ç† (Positions)

**è·¯å¾„**: `/positions`

**åŠŸèƒ½æè¿°**:
- æŸ¥çœ‹ç”¨æˆ·çš„æ‰€æœ‰æµåŠ¨æ€§å¤´å¯¸
- æ˜¾ç¤ºå¤´å¯¸çš„æ”¶ç›Šå’Œè´¹ç”¨
- ç®¡ç†å¤´å¯¸ï¼ˆå¢åŠ /ç§»é™¤æµåŠ¨æ€§ã€é¢†å–è´¹ç”¨ï¼‰

**æ ¸å¿ƒç»„ä»¶**: `PositionsPage`

**æ˜¾ç¤ºä¿¡æ¯**:

1. **ç»Ÿè®¡æ¦‚è§ˆ**
   - æ´»è·ƒå¤´å¯¸æ•°é‡
   - æ€»ä»·å€¼ (USD)
   - æœªé¢†å–è´¹ç”¨
   - æ€»æ”¶ç›Šç‡

2. **å¤´å¯¸åˆ—è¡¨**
   æ¯ä¸ªå¤´å¯¸æ˜¾ç¤º:
   - äº¤æ˜“å¯¹å’Œè´¹ç‡
   - ä»·æ ¼èŒƒå›´ï¼ˆèŒƒå›´å†…/èŒƒå›´å¤–çŠ¶æ€ï¼‰
   - æµåŠ¨æ€§ä»·å€¼
   - æœªé¢†å–è´¹ç”¨ï¼ˆToken0 + Token1ï¼‰
   - Tick èŒƒå›´
   - æ“ä½œæŒ‰é’®:
     - å¢åŠ æµåŠ¨æ€§
     - ç§»é™¤æµåŠ¨æ€§
     - é¢†å–è´¹ç”¨

**æ•°æ®æ¥æº**:
- Hook: `usePositions`
- ä»åç«¯ API è·å–ç”¨æˆ·çš„å¤´å¯¸æ•°æ®

**å…³é”®ä»£ç ä½ç½®**:
- é¡µé¢: `src/app/positions/page.tsx`
- Hook: `src/hooks/usePositions.ts`

---

### 6. åŒºå—é“¾æ‰«æå™¨ (Scanner)

**è·¯å¾„**: `/scanner`

**åŠŸèƒ½æè¿°**:
- æŸ¥çœ‹é“¾ä¸Šäº¤æ˜“è®°å½•
- æŸ¥çœ‹æ± å­ç»Ÿè®¡ä¿¡æ¯
- æŸ¥çœ‹å¹³å°æ•´ä½“æ•°æ®

**æ ¸å¿ƒç»„ä»¶**: `ScannerPage`

**åŠŸèƒ½æ¨¡å—**:

1. **ç»Ÿè®¡æ¦‚è§ˆ**
   - æ€»äº¤æ˜“æ•°
   - æµåŠ¨æ€§æ± æ•°
   - ç‹¬ç«‹äº¤æ˜“è€…æ•°
   - ä»Šæ—¥äº¤æ˜“é‡
   - ä»Šæ—¥äº¤æ˜“æ¬¡æ•°
   - æµåŠ¨æ€§å˜æ›´æ¬¡æ•°

2. **äº¤æ˜“è®°å½•**
   - æ˜¾ç¤ºæ‰€æœ‰äº¤æ¢äº¤æ˜“
   - åŒ…å«äº¤æ˜“å“ˆå¸Œã€æ—¶é—´ã€äº¤æ˜“å¯¹ã€æ•°é‡ç­‰
   - æ”¯æŒåˆ†é¡µæµè§ˆ

3. **æµåŠ¨æ€§æ± åˆ—è¡¨**
   - æ˜¾ç¤ºæ‰€æœ‰æ± å­çš„ç»Ÿè®¡ä¿¡æ¯
   - åŒ…å«äº¤æ˜“æ¬¡æ•°ã€æ€»äº¤æ˜“é‡ç­‰

**æ•°æ®æ¥æº**:
- API: `/api/scanner`
- ä»æ•°æ®åº“æŸ¥è¯¢é“¾ä¸Šäº‹ä»¶æ•°æ®

**å…³é”®ä»£ç ä½ç½®**:
- é¡µé¢: `src/app/scanner/page.tsx`
- API: `src/app/api/scanner/route.ts`

---

### 7. ä»£å¸é“¸é€  (Release)

**è·¯å¾„**: `/release`

**åŠŸèƒ½æè¿°**:
- éƒ¨ç½² ERC20 ä»£å¸åˆçº¦
- è‡ªåŠ¨é“¸é€ åˆå§‹ä»£å¸
- å¿«é€Ÿæ·»åŠ åˆ°é’±åŒ…
- è·³è½¬åˆ°æ·»åŠ æµåŠ¨æ€§

**æ ¸å¿ƒç»„ä»¶**: `ReleasePage`

**ä¸šåŠ¡æµç¨‹**:

1. **éƒ¨ç½²åˆçº¦**
   - è¾“å…¥ä»£å¸åç§° (Name)
   - è¾“å…¥ä»£å¸ç¬¦å· (Symbol)
   - ç‚¹å‡»éƒ¨ç½²æŒ‰é’®
   - ç­‰å¾…äº¤æ˜“ç¡®è®¤

2. **å®Œæˆéƒ¨ç½²**
   - æ˜¾ç¤ºåˆçº¦åœ°å€
   - æç¤ºå·²è‡ªåŠ¨é“¸é€  100,000 ä»£å¸
   - æä¾›"æ·»åŠ åˆ°é’±åŒ…"æŒ‰é’®
   - æä¾›"å»æ·»åŠ æµåŠ¨æ€§"æŒ‰é’®

**å…³é”®åŠŸèƒ½**:
- ä½¿ç”¨ `walletClient.deployContract` éƒ¨ç½²åˆçº¦
- åˆçº¦éƒ¨ç½²åè‡ªåŠ¨é“¸é€ åˆå§‹ä»£å¸
- æ”¯æŒæ·»åŠ åˆ° MetaMask ç­‰é’±åŒ…

**å…³é”®ä»£ç ä½ç½®**:
- é¡µé¢: `src/app/release/page.tsx`
- åˆçº¦é…ç½®: `src/lib/release-contract.ts`

---

## ä¸šåŠ¡æµç¨‹è¯¦è§£

### ä»£å¸äº¤æ¢æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·é€‰æ‹©ä»£å¸] --> B[è¾“å…¥äº¤æ¢æ•°é‡]
    B --> C[è·å–ä»·æ ¼æŠ¥ä»·]
    C --> D{æŠ¥ä»·æˆåŠŸ?}
    D -->|æ˜¯| E[æ£€æŸ¥æˆæƒçŠ¶æ€]
    D -->|å¦| F[æ˜¾ç¤ºé”™è¯¯]
    E --> G{éœ€è¦æˆæƒ?}
    G -->|æ˜¯| H[æ‰§è¡Œæˆæƒäº¤æ˜“]
    G -->|å¦| I[æ‰§è¡Œäº¤æ¢äº¤æ˜“]
    H --> J[ç­‰å¾…æˆæƒç¡®è®¤]
    J --> I
    I --> K[ç­‰å¾…äº¤æ˜“ç¡®è®¤]
    K --> L[æ˜¾ç¤ºäº¤æ˜“ç»“æœ]
```

**è¯¦ç»†æ­¥éª¤**:

1. **ä»£å¸é€‰æ‹©**
   - ç”¨æˆ·ä»ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©è¾“å…¥ä»£å¸å’Œè¾“å‡ºä»£å¸
   - å¯ä»¥ç‚¹å‡»äº¤æ¢æŒ‰é’®å¿«é€Ÿåˆ‡æ¢

2. **æ•°é‡è¾“å…¥**
   - ç”¨æˆ·è¾“å…¥è¦äº¤æ¢çš„æ•°é‡
   - å¯ä»¥ç‚¹å‡»"æœ€å¤§"æŒ‰é’®ä½¿ç”¨å…¨éƒ¨ä½™é¢
   - ç³»ç»Ÿè‡ªåŠ¨éªŒè¯è¾“å…¥æ ¼å¼

3. **ä»·æ ¼æŠ¥ä»·**
   - è¾“å…¥å 500ms é˜²æŠ–ï¼Œè‡ªåŠ¨è°ƒç”¨ `/api/quote`
   - æ˜¾ç¤ºé¢„ä¼°è¾“å‡ºæ•°é‡å’Œä»·æ ¼æ¯”ç‡
   - å¦‚æœæŠ¥ä»·å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

4. **æˆæƒæ£€æŸ¥**
   - æ£€æŸ¥è¾“å…¥ä»£å¸å¯¹ SwapRouter çš„æˆæƒé¢åº¦
   - å¦‚æœæˆæƒä¸è¶³ï¼Œæ˜¾ç¤ºæˆæƒæŒ‰é’®

5. **æˆæƒäº¤æ˜“**
   - è°ƒç”¨ ERC20 çš„ `approve` å‡½æ•°
   - æˆæƒé¢åº¦ä¸ºè¾“å…¥æ•°é‡
   - ç­‰å¾…äº¤æ˜“ç¡®è®¤ååˆ·æ–°æˆæƒçŠ¶æ€

6. **æ‰§è¡Œäº¤æ¢**
   - è°ƒç”¨ SwapRouter çš„ `exactInput` å‡½æ•°
   - ä¼ å…¥ä»£å¸åœ°å€ã€æ•°é‡ã€æ»‘ç‚¹ç­‰å‚æ•°
   - ç­‰å¾…äº¤æ˜“ç¡®è®¤

7. **ç»“æœå±•ç¤º**
   - æ˜¾ç¤ºäº¤æ˜“å“ˆå¸Œ
   - æä¾›é“¾æ¥åˆ°åŒºå—æµè§ˆå™¨
   - åˆ·æ–°ä»£å¸ä½™é¢

---

### æ·»åŠ æµåŠ¨æ€§æµç¨‹

```mermaid
graph TD
    A[é€‰æ‹©ä»£å¸å’Œè´¹ç‡] --> B[æœç´¢æ± å­]
    B --> C{æ± å­å­˜åœ¨?}
    C -->|æ˜¯| D[é€‰æ‹©ä½¿ç”¨ç°æœ‰æ± å­æˆ–åˆ›å»ºæ–°æ± å­]
    C -->|å¦| E[è¿›å…¥æ·»åŠ æµåŠ¨æ€§ç•Œé¢]
    D -->|ä½¿ç”¨ç°æœ‰| E
    D -->|åˆ›å»ºæ–°| E
    E --> F{æ–°æ± å­?}
    F -->|æ˜¯| G[è®¾ç½®åˆå§‹ä»·æ ¼]
    F -->|å¦| H[è·å–æ± å­å½“å‰ä»·æ ¼]
    G --> I[è¾“å…¥ä»£å¸æ•°é‡]
    H --> I
    I --> J[è®¡ç®—å¯¹åº”æ•°é‡]
    J --> K[æ£€æŸ¥æˆæƒ]
    K --> L{éœ€è¦æˆæƒ?}
    L -->|æ˜¯| M[æ‰§è¡Œæˆæƒ]
    L -->|å¦| N[æ‰§è¡Œæ·»åŠ æµåŠ¨æ€§]
    M --> O[ç­‰å¾…æˆæƒç¡®è®¤]
    O --> N
    N --> P[ç­‰å¾…äº¤æ˜“ç¡®è®¤]
    P --> Q[å®Œæˆ]
```

**è¯¦ç»†æ­¥éª¤**:

1. **é€‰æ‹©å‚æ•°**
   - è¾“å…¥æˆ–é€‰æ‹© Token0 å’Œ Token1 åœ°å€
   - é€‰æ‹©è´¹ç‡ç­‰çº§ï¼ˆ0.05%, 0.3%, 1%ï¼‰
   - ç¡®è®¤é“¾ ID

2. **æœç´¢æ± å­**
   - è°ƒç”¨ `/api/pools/check` æ£€æŸ¥æ± å­
   - ä¼ å…¥ token0, token1, fee å‚æ•°
   - è¿”å›æ± å­æ˜¯å¦å­˜åœ¨ã€åœ°å€ã€ç´¢å¼•ç­‰ä¿¡æ¯

3. **å¤„ç†æœç´¢ç»“æœ**
   - **æ± å­å­˜åœ¨**: æ˜¾ç¤ºæ± å­ä¿¡æ¯ï¼Œæä¾›ä½¿ç”¨æˆ–åˆ›å»ºé€‰é¡¹
   - **æ± å­ä¸å­˜åœ¨**: ç›´æ¥è¿›å…¥åˆ›å»ºæµç¨‹

4. **ä»·æ ¼è®¾ç½®/è·å–**
   - **æ–°æ± å­**: ç”¨æˆ·è®¾ç½®åˆå§‹ä»·æ ¼æ¯”ç‡ï¼ˆå¦‚ 1 MNA = 2 MNBï¼‰
   - **å·²å­˜åœ¨æ± å­**: è°ƒç”¨ `/api/pools/price` è·å–å½“å‰ä»·æ ¼

5. **æ•°é‡è¾“å…¥å’Œè®¡ç®—**
   - ç”¨æˆ·è¾“å…¥ä¸€ä¸ªä»£å¸çš„æ•°é‡
   - ç³»ç»Ÿæ ¹æ®ä»·æ ¼è‡ªåŠ¨è®¡ç®—å¦ä¸€ä¸ªä»£å¸çš„æ•°é‡
   - æ”¯æŒç‚¹å‡»"æœ€å¤§"ä½¿ç”¨å…¨éƒ¨ä½™é¢

6. **æˆæƒæ£€æŸ¥**
   - æ£€æŸ¥ä¸¤ä¸ªä»£å¸å¯¹ PositionManager çš„æˆæƒ
   - å¦‚æœæˆæƒä¸è¶³ï¼Œåˆ†åˆ«æ˜¾ç¤ºæˆæƒæŒ‰é’®

7. **æ‰§è¡Œäº¤æ˜“**
   - **æ–°æ± å­**: è°ƒç”¨ `PoolManager.createAndInitializePoolIfNecessary`
     - ä¼ å…¥ä»£å¸åœ°å€ã€è´¹ç‡ã€ä»·æ ¼èŒƒå›´ã€åˆå§‹ä»·æ ¼
   - **å·²å­˜åœ¨æ± å­**: è°ƒç”¨ `PositionManager.mint`
     - ä¼ å…¥æ± å­ç´¢å¼•ã€ä»£å¸æ•°é‡ã€æ¥æ”¶åœ°å€ç­‰

8. **å®Œæˆ**
   - ç­‰å¾…äº¤æ˜“ç¡®è®¤
   - æ˜¾ç¤ºäº¤æ˜“ç»“æœ
   - å¯é€‰ï¼šåˆ·æ–°æ± å­çŠ¶æ€

---

### å¤´å¯¸ç®¡ç†æµç¨‹

```mermaid
graph TD
    A[è¿æ¥é’±åŒ…] --> B[è·å–ç”¨æˆ·å¤´å¯¸åˆ—è¡¨]
    B --> C[æ˜¾ç¤ºå¤´å¯¸ç»Ÿè®¡]
    C --> D[æ˜¾ç¤ºå¤´å¯¸è¯¦æƒ…]
    D --> E{ç”¨æˆ·æ“ä½œ}
    E -->|å¢åŠ æµåŠ¨æ€§| F[è·³è½¬åˆ°æµåŠ¨æ€§é¡µé¢]
    E -->|ç§»é™¤æµåŠ¨æ€§| G[è°ƒç”¨ removeLiquidity]
    E -->|é¢†å–è´¹ç”¨| H[è°ƒç”¨ collectFees]
    F --> I[å®Œæˆ]
    G --> I
    H --> I
```

**å¤´å¯¸ä¿¡æ¯åŒ…å«**:

- æ± å­åœ°å€å’Œäº¤æ˜“å¯¹
- è´¹ç‡ç­‰çº§
- ä»·æ ¼èŒƒå›´ï¼ˆTick Lower/Upperï¼‰
- å½“å‰ä»·æ ¼æ˜¯å¦åœ¨èŒƒå›´å†…
- æµåŠ¨æ€§æ•°é‡
- æœªé¢†å–çš„è´¹ç”¨ï¼ˆToken0 å’Œ Token1ï¼‰
- å¤´å¯¸ä»·å€¼ï¼ˆUSDï¼‰

---

## æŠ€æœ¯æ¶æ„

### é¡¹ç›®ç»“æ„

```
dex-frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router é¡µé¢
â”‚   â”‚   â”œâ”€â”€ page.tsx           # ä¸»é¡µï¼ˆäº¤æ¢ç•Œé¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ pools/             # æ± å­ç›¸å…³é¡µé¢
â”‚   â”‚   â”œâ”€â”€ positions/         # å¤´å¯¸ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ liquidity/        # æµåŠ¨æ€§ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ nfts/              # NFT é¡µé¢
â”‚   â”‚   â”œâ”€â”€ scanner/           # æ‰«æå™¨é¡µé¢
â”‚   â”‚   â”œâ”€â”€ release/           # ä»£å¸é“¸é€ é¡µé¢
â”‚   â”‚   â””â”€â”€ api/               # API è·¯ç”±
â”‚   â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layout/            # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ swap/              # äº¤æ¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pools/             # æ± å­ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ nft/               # NFT ç»„ä»¶
â”‚   â”‚   â””â”€â”€ providers/         # Context Providers
â”‚   â”œâ”€â”€ hooks/                 # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ useSwap.ts         # äº¤æ¢é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ usePools.ts        # æ± å­æ•°æ®
â”‚   â”‚   â”œâ”€â”€ usePositions.ts    # å¤´å¯¸æ•°æ®
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ lib/                   # å·¥å…·å‡½æ•°å’Œé…ç½®
â”‚       â”œâ”€â”€ constants.ts       # åˆçº¦åœ°å€å’Œå¸¸é‡
â”‚       â”œâ”€â”€ contracts.ts       # åˆçº¦ ABI é…ç½®
â”‚       â”œâ”€â”€ utils.ts           # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ wagmi.ts           # Wagmi é…ç½®
```

### æ ¸å¿ƒ Hooks

#### useSwap

**åŠŸèƒ½**: å¤„ç†ä»£å¸äº¤æ¢é€»è¾‘

**ä¸»è¦æ–¹æ³•**:
- `getQuote(params)`: è·å–ä»·æ ¼æŠ¥ä»·
- `approveToken(tokenAddress, amount)`: æˆæƒä»£å¸
- `executeSwap(params)`: æ‰§è¡Œäº¤æ¢
- `useTokenAllowance(tokenAddress)`: æ£€æŸ¥æˆæƒçŠ¶æ€

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
const {
  executeSwap,
  approveToken,
  getQuote,
  useTokenAllowance,
  isPending,
  isConfirming,
  isConfirmed,
  hash,
} = useSwap()
```

#### usePools

**åŠŸèƒ½**: è·å–æ± å­åˆ—è¡¨æ•°æ®

**è¿”å›æ•°æ®**:
- `pools`: æ± å­åˆ—è¡¨
- `loading`: åŠ è½½çŠ¶æ€
- `error`: é”™è¯¯ä¿¡æ¯
- `totalStats`: ç»Ÿè®¡æ•°æ®

#### usePositions

**åŠŸèƒ½**: è·å–ç”¨æˆ·çš„æµåŠ¨æ€§å¤´å¯¸

**è¿”å›æ•°æ®**:
- `positions`: å¤´å¯¸åˆ—è¡¨
- `stats`: ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»ä»·å€¼ã€æœªé¢†å–è´¹ç”¨ç­‰ï¼‰
- `loading`: åŠ è½½çŠ¶æ€
- `error`: é”™è¯¯ä¿¡æ¯

### Web3 é…ç½®

**Wagmi é…ç½®** (`src/lib/wagmi.ts`):
- é…ç½® Sepolia æµ‹è¯•ç½‘
- è®¾ç½® RPC èŠ‚ç‚¹
- é…ç½® RainbowKit é’±åŒ…è¿æ¥

**åˆçº¦åœ°å€** (`src/lib/constants.ts`):
- PoolManager: `0xddC12b3F9F7C91C79DA7433D8d212FB78d609f7B`
- PositionManager: `0xbe766Bf20eFfe431829C5d5a2744865974A0B610`
- SwapRouter: `0xD2c220143F5784b3bD84ae12747d97C8A36CeCB2`

**æµ‹è¯•ä»£å¸**:
- MNA: `0x4798388e3adE569570Df626040F07DF71135C48E`
- MNB: `0x5A4eA3a013D42Cfd1B1609d19f6eA998EeE06D30`
- MNC: `0x86B5df6FF459854ca91318274E47F4eEE245CF28`
- MND: `0x7af86B1034AC4C925Ef5C3F637D1092310d83F03`

---

## API æ¥å£è¯´æ˜

### äº¤æ¢ç›¸å…³

#### GET/POST `/api/quote`

**åŠŸèƒ½**: è·å–ä»£å¸äº¤æ¢ä»·æ ¼æŠ¥ä»·

**è¯·æ±‚å‚æ•°**:
```json
{
  "tokenIn": "0x...",
  "tokenOut": "0x...",
  "amountIn": "1000000000000000000",
  "indexPath": [0],
  "sqrtPriceLimitX96": "0"
}
```

**å“åº”**:
```json
{
  "amountOut": "2000000000000000000",
  "priceImpact": "0.5",
  "simulated": false
}
```

#### POST `/api/allowance`

**åŠŸèƒ½**: æ£€æŸ¥ä»£å¸æˆæƒé¢åº¦

**è¯·æ±‚å‚æ•°**:
```json
{
  "token": "0x...",
  "owner": "0x...",
  "spender": "0x..."
}
```

**å“åº”**:
```json
{
  "success": true,
  "allowance": "1000000000000000000"
}
```

### æ± å­ç›¸å…³

#### GET `/api/pools`

**åŠŸèƒ½**: è·å–æ± å­åˆ—è¡¨

**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼ˆé»˜è®¤ 1ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤ 10ï¼‰

**å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "pool": "0x...",
      "token0": "0x...",
      "token1": "0x...",
      "token0Symbol": "MNA",
      "token1Symbol": "MNB",
      "fee": 3000,
      "feePercent": "0.30%",
      "liquidity": "1000000",
      "tvl": "$50000",
      "tvlUSD": 50000,
      "volume24h": "$10000",
      "feesUSD": 30
    }
  ],
  "pagination": {
    "total": 10,
    "page": 1,
    "limit": 10
  }
}
```

#### POST `/api/pools/check`

**åŠŸèƒ½**: æ£€æŸ¥æ± å­æ˜¯å¦å­˜åœ¨

**è¯·æ±‚å‚æ•°**:
```json
{
  "token0": "0x...",
  "token1": "0x...",
  "fee": 3000
}
```

**å“åº”**:
```json
{
  "success": true,
  "exists": true,
  "poolAddress": "0x...",
  "poolIndex": 0
}
```

#### POST `/api/pools/price`

**åŠŸèƒ½**: è·å–æ± å­ä»·æ ¼å¹¶è®¡ç®—å¯¹åº”æ•°é‡

**è¯·æ±‚å‚æ•°**:
```json
{
  "poolAddress": "0x...",
  "inputToken": "0x...",
  "inputAmount": "100"
}
```

**å“åº”**:
```json
{
  "success": true,
  "outputAmount": "200"
}
```

#### GET `/api/pools/[address]`

**åŠŸèƒ½**: è·å–æ± å­è¯¦ç»†ä¿¡æ¯

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "pool": "0x...",
    "token0": "0x...",
    "token1": "0x...",
    "fee": 3000,
    "liquidity": "1000000",
    "sqrtPriceX96": "...",
    "tick": 0,
    "swaps": [...]
  }
}
```

### æ‰«æå™¨ç›¸å…³

#### GET `/api/scanner`

**åŠŸèƒ½**: è·å–æ‰«æå™¨æ•°æ®

**æŸ¥è¯¢å‚æ•°**:
- `action`: `stats` | `swaps` | `pools`
- `page`: é¡µç ï¼ˆswaps æ—¶ä½¿ç”¨ï¼‰
- `limit`: æ¯é¡µæ•°é‡ï¼ˆswaps æ—¶ä½¿ç”¨ï¼‰

**å“åº”ç¤ºä¾‹ (stats)**:
```json
{
  "success": true,
  "data": {
    "total_swaps": 1000,
    "total_pools": 10,
    "total_liquidity_changes": 500,
    "unique_traders": 200,
    "daily_volume": "1000000000000000000000",
    "daily_trades": 50
  }
}
```

### NFT ç›¸å…³

#### GET `/api/nfts`

**åŠŸèƒ½**: è·å–åœ°å€çš„ NFT åˆ—è¡¨

**æŸ¥è¯¢å‚æ•°**:
- `address`: é’±åŒ…åœ°å€

**å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "tokenId": "1",
      "contractAddress": "0x...",
      "metadata": {...}
    }
  ]
}
```

---

## å¼€å‘æŒ‡å—

### ç¯å¢ƒè®¾ç½®

1. **å®‰è£…ä¾èµ–**
```bash
bun install
```

2. **é…ç½®ç¯å¢ƒå˜é‡**
åˆ›å»º `.env.local` æ–‡ä»¶:
```env
NEXT_PUBLIC_CHAIN_ID=11155111
NEXT_PUBLIC_RPC_URL=https://sepolia.infura.io/v3/...
```

3. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
```bash
bun dev
```

### æ·»åŠ æ–°åŠŸèƒ½

#### 1. æ·»åŠ æ–°é¡µé¢

åœ¨ `src/app/` ä¸‹åˆ›å»ºæ–°ç›®å½•å’Œ `page.tsx`:

```typescript
export default function NewPage() {
  return <div>æ–°é¡µé¢</div>
}
```

#### 2. åˆ›å»ºæ–°ç»„ä»¶

åœ¨ `src/components/` ä¸‹åˆ›å»ºç»„ä»¶æ–‡ä»¶:

```typescript
'use client'

export default function NewComponent() {
  return <div>æ–°ç»„ä»¶</div>
}
```

#### 3. åˆ›å»ºè‡ªå®šä¹‰ Hook

åœ¨ `src/hooks/` ä¸‹åˆ›å»º Hook æ–‡ä»¶:

```typescript
import { useState } from 'react'

export function useNewHook() {
  const [data, setData] = useState(null)
  
  return { data }
}
```

#### 4. æ·»åŠ  API è·¯ç”±

åœ¨ `src/app/api/` ä¸‹åˆ›å»ºæ–°ç›®å½•å’Œ `route.ts`:

```typescript
import { NextResponse } from 'next/server'

export async function GET() {
  return NextResponse.json({ success: true })
}
```

### æœ€ä½³å®è·µ

1. **ç»„ä»¶è®¾è®¡**
   - ä½¿ç”¨ `'use client'` æ ‡è®°å®¢æˆ·ç«¯ç»„ä»¶
   - ä¿æŒç»„ä»¶å•ä¸€èŒè´£
   - ä½¿ç”¨ TypeScript ç±»å‹å®šä¹‰

2. **çŠ¶æ€ç®¡ç†**
   - ä½¿ç”¨ React Query ç®¡ç†æœåŠ¡å™¨çŠ¶æ€
   - ä½¿ç”¨ useState/useReducer ç®¡ç†æœ¬åœ°çŠ¶æ€
   - é¿å…ä¸å¿…è¦çš„å…¨å±€çŠ¶æ€

3. **é”™è¯¯å¤„ç†**
   - æ‰€æœ‰ API è°ƒç”¨éƒ½è¦æœ‰é”™è¯¯å¤„ç†
   - æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
   - è®°å½•é”™è¯¯æ—¥å¿—

4. **æ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨é˜²æŠ–å¤„ç†é¢‘ç¹çš„ API è°ƒç”¨
   - ä½¿ç”¨ React.memo ä¼˜åŒ–ç»„ä»¶æ¸²æŸ“
   - æ‡’åŠ è½½éå…³é”®ç»„ä»¶

5. **ç”¨æˆ·ä½“éªŒ**
   - æ˜¾ç¤ºåŠ è½½çŠ¶æ€
   - æä¾›äº¤æ˜“çŠ¶æ€åé¦ˆ
   - ä½¿ç”¨ Toast é€šçŸ¥ç”¨æˆ·

### å¸¸è§é—®é¢˜

#### 1. äº¤æ˜“å¤±è´¥

**å¯èƒ½åŸå› **:
- Gas ä¸è¶³
- æ»‘ç‚¹è¿‡å¤§
- æˆæƒä¸è¶³
- æ± å­æµåŠ¨æ€§ä¸è¶³

**è§£å†³æ–¹æ³•**:
- æ£€æŸ¥é’±åŒ…ä½™é¢
- è°ƒæ•´æ»‘ç‚¹è®¾ç½®
- ç¡®è®¤æˆæƒçŠ¶æ€
- æ£€æŸ¥æ± å­çŠ¶æ€

#### 2. ä»·æ ¼æŠ¥ä»·å¤±è´¥

**å¯èƒ½åŸå› **:
- æ± å­ä¸å­˜åœ¨
- è·¯å¾„æ— æ•ˆ
- æ•°é‡è¿‡å¤§

**è§£å†³æ–¹æ³•**:
- æ£€æŸ¥ä»£å¸åœ°å€æ˜¯å¦æ­£ç¡®
- ç¡®è®¤æ± å­å·²åˆ›å»º
- å‡å°‘äº¤æ¢æ•°é‡

#### 3. æˆæƒä¸ç”Ÿæ•ˆ

**å¯èƒ½åŸå› **:
- äº¤æ˜“æœªç¡®è®¤
- æˆæƒé¢åº¦ä¸è¶³

**è§£å†³æ–¹æ³•**:
- ç­‰å¾…äº¤æ˜“ç¡®è®¤
- æ£€æŸ¥æˆæƒé¢åº¦
- é‡æ–°æˆæƒ

---

## æ€»ç»“

MetaNodeSwap DEX å‰ç«¯æä¾›äº†å®Œæ•´çš„å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… **ä»£å¸äº¤æ¢**: æ”¯æŒä»»æ„ä»£å¸äº¤æ¢ï¼Œå®æ—¶ä»·æ ¼æŠ¥ä»·
2. âœ… **æµåŠ¨æ€§ç®¡ç†**: åˆ›å»ºæ± å­ã€æ·»åŠ /ç§»é™¤æµåŠ¨æ€§
3. âœ… **å¤´å¯¸ç®¡ç†**: æŸ¥çœ‹å’Œç®¡ç†æµåŠ¨æ€§å¤´å¯¸
4. âœ… **æ•°æ®å¯è§†åŒ–**: æ± å­ç»Ÿè®¡ã€äº¤æ˜“è®°å½•ç­‰
5. âœ… **NFT åŠŸèƒ½**: NFT æ”¶è—å’Œ API æµ‹è¯•
6. âœ… **åŒºå—é“¾æ‰«æ**: é“¾ä¸Šæ•°æ®æŸ¥è¯¢å’Œåˆ†æ
7. âœ… **ä»£å¸é“¸é€ **: ä¸€é”®éƒ¨ç½² ERC20 ä»£å¸

è¯¥å¹³å°åŸºäºç°ä»£åŒ–çš„æŠ€æœ¯æ ˆæ„å»ºï¼Œæä¾›äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå¼€å‘ä½“éªŒã€‚é€šè¿‡æœ¬æ–‡æ¡£ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿç†è§£ä¸šåŠ¡é€»è¾‘ï¼Œè¿›è¡ŒåŠŸèƒ½æ‰©å±•å’Œä¼˜åŒ–ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024å¹´  
**ç»´æŠ¤è€…**: MetaNodeSwap å¼€å‘å›¢é˜Ÿ

